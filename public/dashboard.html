<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="dashboard-container">
        <h2>Adicione os contatos Aqui!</h2>
        
        <!-- Formulário para adicionar contatos -->
        <div class="form-container">
            <h3>Adicionar Contato</h3>
            <input type="text" id="contactName" placeholder="Nome">
            <input type="text" id="contactPhone" placeholder="Telefone">
            <button onclick="addContact()">Adicionar</button>
        </div>

        <!-- Lista de contatos -->
        <div class="contacts-container">
            <h3></h3>
            <ul id="contactsList"></ul>
        </div>

        <!-- Botões de ação -->
        <div class="dashboard-actions">
            <button class="view-contacts-btn" onclick="window.location.href='/users'">
                Ver Todos os Contatos
            </button>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
    </div>

    <script>
        // Função para adicionar um contato
        async function addContact() {
            const name = document.getElementById("contactName").value;
            const phone = document.getElementById("contactPhone").value;

            if (!name || !phone) {
                alert("Por favor, preencha todos os campos.");
                return;
            }

            try {
                const response = await fetch("/addContact", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${localStorage.getItem("token")}`
                    },
                    body: JSON.stringify({ name, phone })
                });

                if (response.ok) {
                    alert("Contato adicionado com sucesso!");
                    loadContacts();
                } else {
                    const errorData = await response.json();
                    alert(`Erro: ${errorData.error}`);
                }
            } catch (error) {
                console.error("Erro ao adicionar contato:", error);
                alert("Erro ao adicionar contato. Verifique o console para mais detalhes.");
            }
        }

        // Função para carregar contatos
        async function loadContacts() {
            try {
                const response = await fetch("/getContacts", {
                    headers: {
                        "Authorization": `Bearer ${localStorage.getItem("token")}`
                    }
                });

                if (response.ok) {
                    const contacts = await response.json();
                    const contactsList = document.getElementById("contactsList");
                    contactsList.innerHTML = "";

                    contacts.forEach(contact => {
                        const li = document.createElement("li");
                        const createdAt = new Date(contact.createdAt).toLocaleString("pt-BR", {
                            day: "2-digit",
                            month: "2-digit",
                            year: "numeric",
                            hour: "2-digit",
                            minute: "2-digit",
                            second: "2-digit"
                        });

                        li.textContent = `${contact.name}: ${contact.phone} (Adicionado em: ${createdAt})`;
                        contactsList.appendChild(li);
                    });
                } else {
                    alert("Erro ao carregar contatos.");
                }
            } catch (error) {
                console.error("Erro ao carregar contatos:", error);
            }
        }

        // Função para logout
        function logout() {
            localStorage.removeItem("token");
            window.location.href = "index.html";
        }

        // Carrega os contatos ao abrir a página
        window.onload = loadContacts;
    </script>
</body>
</html>
